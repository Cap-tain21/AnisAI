<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no"/>
<title>Quartz Catcher â€” Mobile</title>
<style>
:root{--hud:#66ffff}
html,body{height:100%;margin:0;background:#000;overflow:hidden;-webkit-user-select:none;}
canvas{display:block;width:100vw;height:100vh;touch-action:none;}
#score{position:fixed;left:12px;top:12px;color:var(--hud);font:600 18px/1 monospace;text-shadow:0 0 8px rgba(102,255,255,0.15);z-index:10}
#highscore{position:fixed;right:12px;top:12px;color:var(--hud);font:600 18px/1 monospace;text-shadow:0 0 8px rgba(102,255,255,0.15);z-index:10}
</style>
</head>
<body>
<div id="score">Score: 0</div>
<div id="highscore">High: 0</div>
<canvas id="game"></canvas>
<script>
(() => {
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d', {alpha:false});
const scoreHud = document.getElementById('score');
const highHud = document.getElementById('highscore');
let w=0,h=0;
function resize(){ w=canvas.width=innerWidth; h=canvas.height=innerHeight; player.baseY=Math.max(60,h-140); player.x=Math.max(0,Math.min(player.x,w-player.w)); }
window.addEventListener('resize', resize,{passive:true});

let score=0;
let highScore=Number(localStorage.getItem('highScore')||0);

const player={x:0,y:0,w:120,h:20,baseY:0,speed:12,hue:190,bounce:0,color(){return 'hsl('+this.hue+',100%,50%)';}};

function makeQuartz(){return {x:Math.random()*(Math.max(1,w-30)),y:-30-Math.random()*200,size:26,speed:10+Math.random()*1.5,hue:Math.random()*360,trail:[]};}
let quartz = makeQuartz();
let particles=[];

const stars=[];
for(let i=0;i<150;i++){ stars.push({x:Math.random()*2000,y:Math.random()*2000,r:Math.random()*1.2+0.6,base:Math.random()*0.6+0.2,speed:Math.random()*0.08+0.02,phase:Math.random()*Math.PI*2}); }

function drawNightSky(now){
  const grad=ctx.createLinearGradient(0,0,0,h);
  grad.addColorStop(0,'#071022'); grad.addColorStop(1,'#000010'); ctx.fillStyle=grad; ctx.fillRect(0,0,w,h);
  for(let s of stars){
    if(s.x>w) s.x=Math.random()*w; if(s.y>h) s.y=Math.random()*h;
    const alpha=Math.max(0.05,Math.min(1,s.base+0.5*Math.sin(now/1000+s.phase)));
    ctx.beginPath(); ctx.fillStyle='rgba(255,255,255,'+alpha+')'; ctx.arc(s.x,s.y,s.r,0,Math.PI*2); ctx.fill();
    if(alpha>0.25){ctx.beginPath();ctx.fillStyle='rgba(255,255,255,'+(alpha*0.08)+')';ctx.arc(s.x,s.y,s.r*3,0,Math.PI*2);ctx.fill();}
    s.y+=s.speed; if(s.y>h) s.y=0;
  }
}

function drawPlayer(){
  ctx.save();
  ctx.fillStyle=player.color();
  ctx.shadowBlur=16; ctx.shadowColor=player.color();
  const yOffset = Math.sin(player.bounce)*6;
  ctx.fillRect(player.x, player.baseY - yOffset, player.w, player.h);
  ctx.restore();
}

function drawQuartz(q){
  q.hue=(q.hue+2)%360;
  for(let i=0;i<q.trail.length;i++){
    const t=q.trail[i], alpha=1-(i/q.trail.length);
    ctx.save(); ctx.beginPath(); ctx.fillStyle='hsla('+q.hue+',100%,50%,'+(alpha*0.18)+')'; ctx.arc(t.x,t.y,(q.size*alpha)*0.5,0,Math.PI*2); ctx.fill(); ctx.restore();
  }
  ctx.save(); ctx.beginPath(); ctx.fillStyle='hsl('+q.hue+',100%,50%)'; ctx.shadowBlur=18; ctx.shadowColor='hsl('+q.hue+',100%,60%)'; ctx.arc(q.x+q.size/2,q.y+q.size/2,q.size/2,0,Math.PI*2); ctx.fill(); ctx.restore();
  q.trail.unshift({x:q.x+q.size/2,y:q.y+q.size/2}); if(q.trail.length>18) q.trail.pop();
}

function drawParticles(){
  for(let i=particles.length-1;i>=0;i--){
    const p=particles[i]; ctx.save(); ctx.fillStyle=p.color; ctx.beginPath(); ctx.arc(p.x,p.y,p.s,0,Math.PI*2); ctx.fill(); ctx.restore();
    p.x+=p.vx; p.y+=p.vy; p.s*=0.96; p.life--; if(p.s<0.6||p.life<=0) particles.splice(i,1);
  }
}

function spawnParticles(x,y,hue){ for(let i=0;i<12;i++){ const angle=Math.random()*Math.PI*2,speed=1+Math.random()*2.2; particles.push({x:x+(Math.random()-0.5)*10,y:y+(Math.random()-0.5)*10,vx:Math.cos(angle)*speed,vy:Math.sin(angle)*speed*0.6,s:Math.random()*4+2,color:'hsl('+(hue+(Math.random()*40-20))+',100%,60%)',life:30+Math.floor(Math.random()*20)}); } }

function resetGame(fell=false){ if(score>highScore){ highScore=score; localStorage.setItem('highScore',highScore); } score=0; player.w=120; player.hue=190; quartz=makeQuartz(); quartz.trail=[]; if(fell && navigator.vibrate) navigator.vibrate(170); player.bounce=0;}

function updateGame(){
  quartz.y+=quartz.speed;
  if(quartz.y>h){ resetGame(true); player.bounce+=0.7;}
  if(quartz.x<player.x+player.w && quartz.x+quartz.size>player.x && quartz.y<player.baseY+player.h && quartz.y+quartz.size>player.baseY){
    score++; spawnParticles(quartz.x+quartz.size/2,quartz.y+quartz.size/2,quartz.hue); player.hue=quartz.hue;
    quartz.x=Math.random()*(Math.max(1,w-quartz.size)); quartz.y=-40-Math.random()*160; quartz.trail=[]; quartz.hue=Math.random()*360;
    quartz.speed=10+Math.min(16,score*0.7); if(score%5===0 && player.w>56) player.w-=6;
    player.bounce+=0.5;
  }
  player.bounce*=0.92;
  player.x=Math.max(0,Math.min(player.x,w-player.w));
}

document.addEventListener('keydown',(e)=>{if(e.key==='ArrowLeft') player.x-=player.speed; if(e.key==='ArrowRight') player.x+=player.speed;},false);
canvas.addEventListener('touchmove',(e)=>{player.x=e.touches[0].clientX-player.w/2;e.preventDefault();},{passive:false});
canvas.addEventListener('mousedown',(e)=>{player.x=e.clientX-player.w/2;},false);
canvas.addEventListener('mousemove',(e)=>{if(e.buttons) player.x=e.clientX-player.w/2;},false);

function frame(now){ ctx.clearRect(0,0,w,h); drawNightSky(now); drawPlayer(); drawQuartz(quartz); updateGame(); drawParticles(); scoreHud.textContent='Score: '+score; highHud.textContent='High: '+highScore; requestAnimationFrame(frame); }
function init(){ player.x=(innerWidth-player.w)*0.5; player.baseY=Math.max(60,innerHeight-140); resize(); requestAnimationFrame(frame);}
init();
})();
</script>
</body>
</html>
